services:
  claude-flow:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: claude-flow

    # Expose SSE port for MCP
    ports:
      - "8080:8080"

    # Volumes for persistence
    volumes:
      # Claude-Flow init data
      - claude-flow-db:/root/.claude-flow

      # Runtime data: agents, memory.db, settings, skills
      - claude-flow-claude:/.claude

      # Swarm data: memory.db, HNSW vector index
      - claude-flow-swarm:/.swarm

      # Optional: share downloaded npm packages
      - node-modules-cache:/root/.npm

    # Environment variables
    environment:
      - NODE_ENV=production

    # Restart policy
    restart: unless-stopped

# Named volumes for persistence
volumes:
  claude-flow-db:
    driver: local
  claude-flow-claude:
    driver: local
  claude-flow-swarm:
    driver: local
  node-modules-cache:
    driver: local
